<!DOCTYPE HTML>
<html>
  <head>
    <title>SciGrade</title>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta name="author" content="Alexander Sullivan" />
    <!-- jQuery using Google Hosted Library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
    <!-- Stictch/mongoDB -->
    <script src="https://s3.amazonaws.com/stitch-sdks/js/library/v2/stable/stitch.min.js"></script>
    <!-- Google Identity Platform Scripts -->
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <meta name="google-signin-client_id" content="1034277489697-g473uqcd0oc1c02td9off07b9mbe1353.apps.googleusercontent.com">
    <script>
    var googleName;
    var googleEmail;
    /**
    * Retrieves Google user information and stores it
    */
    function onSignIn(googleUser) {
      var profile = googleUser.getBasicProfile();
      googleName = profile.getName();
      googleEmail = profile.getEmail(); // This is null if the 'email' scope is not present.
      if (checkVerifyStudent == true && checkstudentNum == true && studentNumber != 0 && googleEmail != null) {
        client.login().then(() =>
          db.collection("Student_Information").updateOne({version: "0.3"}, { $set: {upper: googleEmail}}, function(err, res) {
          if (err) throw err;
          console.log("1 document updated");
          db.close();
        }));
        redirectCRISPR();
      }
    }

    /**
    * Google signout
    */
    function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut();
      }
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-38961857-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-38961857-6');
    </script>
    <!-- Custom scripts -->
    <script src="scripts\login.js"></script>
    <script src="scripts\crispr_scripts.js"></script>
    <link rel="stylesheet" href="styling\style.css"/>
  </head>
  <body>
    <div class="container-fluid" role="tabpanel" style="padding-top:2%;" id="mainContainer">
      <!-- Login and Regiseration -->
      <div>
        <div class="row">
          <div class="col-sm-1"></div>
          <div class="col-sm-10">
            <ul class="nav nav-tabs"  id="logTabs" role="tablist">
              <li class="nav-item">
                <a class="nav-link" id="login-tab" data-toggle="tab" href="#login" role="tab" aria-controls="login">Login</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="register-tab" data-toggle="tab" href="#register" role="tab" aria-controls="register">Register</a>
              </li>
            </ul>
            <div class="tab-content" id="logTabContent">
              <!-- Login -->
              <div role="tabpanel" class="tab-pane fade" id="login" aria-labelledby="login">
                <form id="login">
                  <div class="form-group">
                    <label for="InputStudentNumber">Student number</label>
                    <input type="number" class="form-control" id="InputStudentNumber" placeholder="1234567890" pattern=".{9,10}">
                    <small id="studentNumberHelp" class="form-text text-muted">We'll never share your student number with anyone else.</small>
                  </div>
                  <div class="form-group">
                    <label for="InputPassword">Password</label>
                    <input type="password" class="form-control" id="InputPassword" placeholder="Password">
                    <small id="passwordHelp" class="form-text text-muted">We'll never share your password with anyone else.</small>
                  </div>
                  <button type="submit" class="btn btn-primary">Login</button>
                </form>
              </div>
              <!-- Registeration -->
              <div role="tabpanel" class="tab-pane fade" id="register" aria-labelledby="register">
                <p> Registration is limited to students in the appropriate University of Toronto HMB class. If you are not in the appropriate HMB class, you cannot register for SciGrade. Though once you have registered for SciGrade, you now have a permanent account and can use SciGrade whenever you want. <p>
                <p id="pP1"> First, please verify that you are a student at the University of Toronto:</p>
                <form id="registerP1">
                  <div class="form-group" id="studentID">
                    <label for="StudentNumber">Student number:</label>
                    <input class="form-control" id="StudentNumber" placeholder="1234567890" maxlength="10">
                    <small id="studentNumberHelp" class="form-text text-muted">Insert your 9 to 10 digit student number to verify you are a student at the University of Toronto.</small>
                  </div>
                  <div class="form-group" id="studentumail">
                    <label for="StudentEmail">Student uMail:</label>
                    <input type="email" class="form-control" id="StudentEmail" placeholder="first.last@mailutoronto.ca">
                    <small id="studentEmailHelp" class="form-text text-muted">Insert your student uMail (email) from the University of Toronto.</small>
                  </div>
                  <button id="firstSubmit" type="button" class="btn btn-primary" onclick="checkStudentNumber(document.getElementById('StudentNumber').value, document.getElementById('StudentEmail').value);">Check</button>
                </form>
                <p id="pP2"></p>
                <form id="registerP2">
                </form>
                <p id="pP3"></p>
                <form id="registerP3" style="display:none;">
                  <div class="g-signin2" data-onsuccess="onSignIn"></div>
                </form>

                <!-- Error with registeration modal -->
                <button id="errorRegButton" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" hidden>
                  Error with registeration
                </button>
                <!-- Modal -->
                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Oops</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body" id="errorRegBody">
                        <p id="errorRegContent">An error happened. If no error is being displayed here, you are not suppose to see this error (unexpected error).</p>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-1"></div>
        </div>
      </div>
    </div>
  </body>
</html>
